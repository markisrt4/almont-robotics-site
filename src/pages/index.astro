---
import BaseLayout from "../layouts/BaseLayout.astro";
import fs from "node:fs";
import path from "node:path";

const base = import.meta.env.BASE_URL;

const PHOTOS_DIR = path.resolve(process.cwd(), "public", "photos");
const isImage = (name) => /\.(jpe?g|png|webp)$/i.test(name);
const encodeFile = (name) => encodeURIComponent(name).replaceAll("%2F", "/");

const files = fs.existsSync(PHOTOS_DIR)
  ? fs.readdirSync(PHOTOS_DIR).filter(isImage)
  : [];

const photoUrls = files.map(f => `${base}photos/${encodeFile(f)}`);

// Pick a strong default hero (you can change this anytime)
const heroPhoto = `${base}photos/208A3608.jpg`;
---

<BaseLayout
  title="Home"
  description="Almont Robotics (FRC 4961) — student-led FIRST Robotics Competition team."
>
  <section class="hero">
    <div class="hero-bg" style={`background-image:url(${heroPhoto});`}></div>
    <div class="hero-overlay"></div>

    <div class="container hero-inner">
      <div class="hero-card">
        <div class="badge">Almont Robotics <span style="opacity:.5;">•</span> FRC 4961</div>

        <h1 class="h1">
          <span class="accent">Student-driven.</span> Student-built. <span class="accent">Team-powered.</span>
        </h1>

        <p class="p">
          Team 4961 is entirely student-led — every design, build, and decision is made by our members.
          From brainstorming to building, we run on student ideas, creativity, and problem-solving.
        </p>

        <div class="btnrow">
          <a class="btn primary" href={`${base}sponsors/`}>Become a Sponsor</a>
          <a class="btn" href={`${base}contact/`}>Join the Team</a>
          <a class="btn" href={`${base}media/`}>View Photos</a>
        </div>

        <div class="hero-stats" aria-label="Quick stats">
          <div class="stat">
            <div class="num" style="color:var(--orange);">FRC</div>
            <div class="label">FIRST Robotics Competition</div>
          </div>
          <div class="stat">
            <div class="num" style="color:var(--green);">4961</div>
            <div class="label">Team Number</div>
          </div>
          <div class="stat">
            <div class="num">Almont, MI</div>
            <div class="label">Community • STEM • Outreach</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <section class="section">
    <div class="container">
      <div class="head">
        <div>
          <div class="kicker">What we do</div>
          <h2 class="h2">Build robots. Build skills. Build people.</h2>
        </div>
      </div>

      <div class="grid3">
        <div class="card" style="padding:1.15rem 1.15rem 1.05rem;">
          <div class="kicker" style="color:rgba(245,104,15,.9);">Design + Build</div>
          <p class="p">Mechanical, electrical, CAD, fabrication, and rapid iteration under real deadlines.</p>
        </div>

        <div class="card" style="padding:1.15rem 1.15rem 1.05rem;">
          <div class="kicker" style="color:rgba(65,154,67,.95);">Programming</div>
          <p class="p">Control systems, autonomous routines, and driver-focused software improvements.</p>
        </div>

        <div class="card" style="padding:1.15rem 1.15rem 1.05rem;">
          <div class="kicker">Community</div>
          <p class="p">Outreach, mentoring, sponsorships, and representing Almont with pride.</p>
        </div>
      </div>
    </div>
  </section>

  <section class="section" style="padding-top:0;">
    <div class="container">
      <div class="head">
        <div>
          <div class="kicker">Fresh from the camera roll</div>
          <h2 class="h2">Random highlights</h2>
        </div>
        <a class="btn" href={`${base}media/`}>See full gallery</a>
      </div>

      <div class="gallery">
        <div class="tile" style="grid-column: span 6;">
          <img id="rnd1" alt="Random team highlight" loading="lazy" />
        </div>
        <div class="tile" style="grid-column: span 6;">
          <img id="rnd2" alt="Random team highlight" loading="lazy" />
        </div>
      </div>
    </div>
  </section>

  <script is:inline define:vars={{ photoUrls }}>
    const urls = photoUrls || [];
    function pickTwo(arr){
      if(arr.length === 0) return ["", ""];
      if(arr.length === 1) return [arr[0], arr[0]];
      const a = Math.floor(Math.random() * arr.length);
      let b = Math.floor(Math.random() * (arr.length - 1));
      if(b >= a) b += 1;
      return [arr[a], arr[b]];
    }

    const [u1, u2] = pickTwo(urls);
    const i1 = document.getElementById("rnd1");
    const i2 = document.getElementById("rnd2");
    if(i1) i1.src = u1;
    if(i2) i2.src = u2;
  </script>
</BaseLayout>